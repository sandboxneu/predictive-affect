<!DOCTYPE html>
<html>
  <head>
    <title>Rating Phase</title>
    <script src="node_modules/jspsych/jspsych.js"></script>
    <script src="node_modules/jspsych/plugins/jspsych-image-keyboard-response.js"></script>
    <script src="node_modules/jspsych/plugins/jspsych-html-slider-response.js"></script>
    <script src="node_modules/jspsych/plugins/jspsych-instructions.js"></script>
    <script src="assets/plugins/jspsych-html-double-slider-response.js"></script>
    <script src="utils.js"></script>
    <link href="predictiveaffect.css" rel="stylesheet" type="text/css"></link>
    <style>
      img {
        width: 300px;
      }
    </style>
  
  </head>
  <body></body>
  <script>

  const timeline = [];


  const testingInstructions = {
    type: 'instructions',
    pages: ['For this part of the experiment, we will show you the images you saw earlier.\n\nFor each image, you will rate how it made you feel.\n\nNote that you will not be able to quit the experiment during this part of the experiment. If you do not wish to continue, please press “Q” to quit now.\n\nTo continue, please press "J".'],
    key_forward: 'j',
   };

   timeline.push(testingInstructions);
  

  var allImagesShown = [];

  tripletTypes.forEach(function(type) {
    allImagesShown = allImagesShown.concat(exemplars[`${type}1`].images);
    allImagesShown = allImagesShown.concat(exemplars[`${type}2`].images);
  });

  allImagesShown.forEach(function(image) {
    var trial = {
      type: 'html-double-slider-response',
      min: [0, 0],
      start: [4,4],
      max: [8,8],
      stimuli: [generateImageHTML(image),''],
      step: [1, 1],
      labels: [],
      slider_count: 2,
      prompt: ["<p>What Valence level would you rate this image?</p>", "<p>What level of arousal would you rate this image?</p>"],
      on_finish: (data) => {
        data.Valence = data.responses[0];
        data.Arousal = data.responses[1];
        data.ImageName = image.fileName;
      }
    };
    var arousalpics = [];
    for(i = 0; i < 9; i++){
      arousalpics.push(`<img src="assets/stimuli/scale/arousal/arousal${i}.png" style="max-width:80%; filter: invert(100%);">`);
    }
    trial.labels.push(arousalpics);
    var valencepics = [];
    for(i = 0; i < 9; i++){
      valencepics.push(`<img src="assets/stimuli/scale/valence/valence${i}.png" style="max-width:80%; filter: invert(100%);">`);
    }
    trial.labels.push(valencepics);
    timeline.push(trial);
  });

  jsPsych.init({
    timeline: timeline,
    on_finish: function() {
        jsPsych.data.get().ignore(['trial_type', 'time_elapsed', 'responses', 'stimulus', 'stimuli', 'internal_node_id', 'view_history']).localSave('csv','rating_output.csv');
        jsPsych.data.displayData();
      },
  });

  </script>
</html>
